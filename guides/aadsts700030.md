# AADSTS700030: Invalid certificate - subject name in certificate isn't authorized. SubjectNames/SubjectAlternativeNames (up to 10) in token certificate are: {certificateSubjects}.


## Troubleshooting Steps
### Troubleshooting Guide for AADSTS700030: Invalid Certificate - Subject Name in Certificate Isn't Authorized

The error code AADSTS700030 indicates that there is an issue with the authentication process due to an invalid certificate. Specifically, it means that the subject name (or Subject Alternative Name) in the certificate doesnâ€™t match what is expected by Azure Active Directory (AAD).

#### Initial Diagnostic Steps

1. **Verify the Error Message**: Carefully review the error message for details about what is wrong with the certificate. Pay close attention to the `certificateSubjects` section.
   
2. **Check Application Configuration**: Verify that the application is correctly configured to use the certificate for authentication. This includes ensuring that the correct certificate is being used and that it's associated with the right application in AAD.

3. **Review the Certificate Information**: Inspect the certificate to check the following:
   - Subject and Subject Alternative Names (SANs)
   - Validity period of the certificate (ensure it is not expired)
   - Issuer information and trust chain

4. **Determine the AAD Tenant**: Identify which AAD tenant the application is trying to access and ensure that certificates are set up correctly in that tenant.

#### Common Issues that Cause This Error

1. **Mismatched Subject Names**: The subject name or SAN of the certificate does not match the expected values configured in AAD.
   
2. **Expired or Invalid Certificate**: The certificate may have expired or is otherwise invalid.

3. **Certificate Not Uploaded/Associated Properly**: The certificate may not have been uploaded to AAD or associated properly with the application registration.

4. **Incorrect AAD Application Registration**: The application might not be registered correctly in AAD.

5. **Multiple Certificates**: When multiple certificates are involved, the application might be referencing an incorrect one.

#### Step-by-Step Resolution Strategies

1. **Inspect the Certificate**:
   - Use a tool like `openssl` or a certificate manager to inspect the details of the certificate.
   - Ensure the subject name and any SANs match what AAD expects.

2. **Update the Certificate in AAD**:
   - Go to the Azure portal.
   - Navigate to **Azure Active Directory > App registrations**.
   - Find your application and go to **Certificates & secrets**.
   - Verify that the uploaded certificate matches the one in use and contains the correct subject names.
   - Remove any old or invalid certificates.

3. **Re-upload a Valid Certificate**:
   - Obtain or generate a new certificate if needed.
   - Ensure the new certificate has the correct subject name and SANs configured.
   - Upload the new certificate to the Azure portal as detailed above.

4. **Test the Application**: After updating the certificate, run your application to verify that the error is resolved.

5. **Check Service Principal**:
   - Ensure that the service principal associated with your application has the necessary permissions and is properly configured.

#### Additional Notes or Considerations

- Check if your application is running in multiple environments (development, staging, production) and ensure the correct certificates are being used in each environment.
- Review any relevant logs in your application to gather more insights on what might be causing the certificate validation failure.
  
#### Documentation Resources

- **Microsoft Docs on Managing Certificates in Azure AD**: [Managing certificates in Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/develop/creating-self-signed-certs)
- **Azure AD Authentication Overview**: [Authentication Scenarios](https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-scenarios)

#### Testing Documentation Accessibility
- Ensure the documentation links provided direct users to the intended pages. You can do this by navigating to them on a web browser.

#### Advice for Data Collection

- Before resolving the issue, collect the following data:
  - Logs from the application that are relevant to the authentication process.
  - Information about the certificate currently in use (e.g., a copy of it, its subject details, and its validity).
  - Any configuration settings related to authentication in the application.
  
Documenting this information can help troubleshoot further if the issue persists after following the steps outlined above.