
# AADSTS700016: UnauthorizedClient_DoesNotMatchRequest - The application wasn't found in the directory/tenant. This can happen if the application has not been installed by the administrator of the tenant or consented to by any user in the tenant. You might have misconfigured the identifier value for the application or sent your authentication request to the wrong tenant.


## Troubleshooting Steps
Troubleshooting the AADSTS700016 error can seem daunting, but with a systematic approach, you can identify and resolve the issues that lead to this error efficiently. This guide will help you with essential steps and strategies to diagnose and fix the problem.

### Understanding AADSTS700016

**Error Code**: AADSTS700016  
**Error Description**: UnauthorizedClient_DoesNotMatchRequest - The application wasn't found in the directory/tenant. This can happen if the application has not been installed by the administrator of the tenant or consented to by any user in the tenant. You might have misconfigured the identifier value for the application or sent your authentication request to the wrong tenant.

### Initial Diagnostic Steps

1. **Identify the Application**: Determine the application you're attempting to authenticate with and what tenant it is registered in.

2. **Review Authentication Request**: Check the authentication request parameters, particularly the `client_id` (application ID), `redirect_uri`, and `tenant_id`.

3. **Check Tenant and Directory**:
   - Confirm which Azure Active Directory (AAD) tenant you are pointing to in your authentication requests.

4. **Logs and Error Messages**: Review error logs on both your application and Azure AD to gain more insights into the issue.

### Common Issues that Cause This Error

1. **Application not Registered**: The application you're using is not registered in the Azure AD tenant you are querying.

2. **Identifier Misconfiguration**: The client ID or redirect URI is incorrectly configured.

3. **Invalid Tenant**: The authentication request is sent to the wrong tenant.

4. **Consent not granted**: Users in the tenant have not consented to using the application.

5. **Multitenant Applicability**: The application might be configured to be single-tenant but is being accessed from a different tenant.

### Step-by-Step Resolution Strategies

1. **Verify Application Registration**:
   - Log into the Azure portal ([portal.azure.com](https://portal.azure.com)).
   - Navigate to Azure Active Directory > App registrations.
   - Search for the application by its name or application ID (client ID).
   - Make sure the application exists in the tenant you are querying.

2. **Check Permissions and Consent**:
   - In the application registration page, go to "API permissions" and ensure necessary permissions are granted.
   - Navigate to "Enterprise applications" in the Azure AD and check if the application is listed. If not listed, and it's a multi-tenant app, the administrator should consent to it.

3. **Review Application Identifier**:
   - Ensure your authentication request's `client_id` matches the registered applicationâ€™s application ID in Azure AD.
   - Validate that the `redirect_uri` matches exactly what is registered (including case sensitivity).

4. **Correct the Tenant Information**:
   - If the error persists, make sure you are targeting the correct tenant in your authentication requests (check the `tenant` parameter).

5. **Reconfigure the Application**:
   - If you are developing the app, consider re-registering it with the correct settings or ensure that user consent is obtained.

6. **Testing**:
   - Once changes have been made, recreate the authentication requests and test to see if the error is resolved.

### Additional Notes or Considerations

- **Multi-Tenant vs. Single Tenant**: Make sure to understand if the application is intended to be used only in one tenant or across multiple tenants and configure accordingly.

- **Clear Tokens**: Sometimes clearing stored tokens can resolve persistent issues resulting from stale data.

### Documentation and Guidance

- Official Azure AD documentation for troubleshooting authentication issues: [Azure Active Directory Authentication and Authorization](https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-scenarios)
- Azure App registration documentation: [Register a new application](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- API permissions documentation: [API permission requests](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent)

### Testing the Documentation

To ensure the documentation links are reachable, you can simply open them in a web browser. Here are the links again for quick access:

- [Azure Active Directory Authentication and Authorization](https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-scenarios)
- [Register a new application](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- [API permission requests](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent)

### Advice for Data Collection

1. **Gather Logs**: Collect application logs and Azure AD sign-in logs around the timeframe of the error occurrence.
2. **Query Parameters Capture**: Log the exact parameters (headers, body, URIs) sent in the authentication request to facilitate debugging.
3. **User Feedback**: If users report errors, collect screenshots or descriptions of actions leading to this error.

By following this guide, you should be able to systematically troubleshoot and resolve the AADSTS700016 error. Good luck!