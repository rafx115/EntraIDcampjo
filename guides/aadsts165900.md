# AADSTS165900: InvalidApiRequest - Invalid request.


## Troubleshooting Steps
### Troubleshooting Guide for Error Code AADSTS165900

**Error Code**: AADSTS165900  
**Description**: InvalidApiRequest - Invalid request.

#### Initial Diagnostic Steps

1. **Understand the Context**: Take note of when the error occurs. Is it during user authentication, API calls, or while accessing a specific resource?
   
2. **Check Azure Active Directory Status**: Verify if there is a service outage impacting Azure Active Directory (AAD). You can check the status at the [Azure Status page](https://status.azure.com).

3. **Review Application Configuration**: Check the application's registered settings in Azure Active Directory. Ensure that necessary permissions, scopes, and redirect URIs are properly configured.

4. **Check API Endpoint**: Ensure that the API endpoint being accessed is correct and accessible from your environment.

#### Common Issues That Cause This Error

- **Invalid Redirect URI**: The redirect URI provided in the request does not match any of the redirect URIs registered in Azure AD.
  
- **Scope Issues**: The requested API scopes or permissions are not specified correctly or are not granted in the AAD application.

- **Resource ID Mismatch**: The resource ID requested in your API call does not match any of the resources registered in Azure AD.

- **Authentication Flow**: An incorrect authentication flow (like trying to use Authorization Code flow instead of Implicit flow) can lead to this error.

- **Malformed Request**: The request may have missing or invalid parameters.

#### Step-by-Step Resolution Strategies

1. **Verify Redirect URI**:
   - Go to the Azure Portal.
   - Navigate to Azure Active Directory > App registrations.
   - Select your application and go to "Authentication".
   - Ensure that the redirect URI in your request matches one of the listed entries.

2. **Check API Scopes**:
   - In the Azure Portal, navigate to your registered application.
   - Go to "API permissions" and ensure that the application has permission to access the APIs you're trying to access.
   - If using scopes, verify that the scopes are being requested correctly.

3. **Confirm Resource ID**:
   - Ensure the resource ID in the API request matches the API you intend to access.
   - Check the registered APIs in the Azure AD App Registrations.

4. **Validate the Authentication Flow**:
   - Review the type of authentication flow you are using (Authorization Code, Implicit, Client Credentials, etc.).
   - Ensure you are following the correct flow based on your application type.

5. **Examine the Request for Malformation**:
   - Use tools like Postman or Fiddler to capture your API requests and check for missing or incorrect parameters.
   - Ensure that all required parameters are included in the request.

6. **Review Application Permissions**:
   - Make sure the app has the necessary permissions granted and that admin consent has been provided if required.

7. **Refer to Logs for Details**:
   - Check the Azure AD audit logs for more context on the error. Navigate to Azure Active Directory > Audit logs. Look for logs around the time the error occurred.

#### Additional Notes or Considerations

- Always ensure that your application and its dependencies are up-to-date, as changes to Azure AD may affect API request formats and requirements.
  
- If you're using libraries for authentication (like MSAL), ensure that you're using the latest version.

- Sometimes caching issues can cause stale data; consider invalidating caches or restarting services to see if the issue persists.

#### Documentation for Guidance

- [Azure Active Directory Application Registration](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- [Choosing an Authentication Flow](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow)
- [API Permissions](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent)
- [Troubleshooting Azure AD Authentication](https://docs.microsoft.com/en-us/azure/active-directory/develop/troubleshoot-azure-ad-authentication)

#### Test Documentation Reachability

- Visit the links provided above to ensure they are accessible. Make sure that you have the appropriate permissions to view any required Azure AD sections.

### Advice for Data Collection

- Collect headers from the error response, including any correlation IDs provided by Azure AD.
  
- Log the exact request URI and payload that led to the error for future reference.

- Include application level logs to see where the failure might be emanating from.

- Investigate the timestamps of the error in comparison to other events to identify any patterns.

Following this structured approach should help in diagnosing and resolving the error code AADSTS165900 effectively. If issues persist, consider reaching out to Microsoft support with the specific details you've collected.