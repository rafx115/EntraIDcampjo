# AADSTS120013: PasswordChangeOnPremisesConnectivityFailure


## Troubleshooting Steps
Sure! Here's a detailed troubleshooting guide for the AADSTS120013 error code, specifically describing the PasswordChangeOnPremisesConnectivityFailure issue in Azure Active Directory (Azure AD):

## Troubleshooting Guide for AADSTS120013: PasswordChangeOnPremisesConnectivityFailure

### Initial Diagnostic Steps
1. **Understand the Context**:
   - Determine when and where the error occurs (e.g., during a password change, logon attempt, etc.).
   - Confirm the identity provider being used (Azure AD, ADFS, etc.).

2. **Check User Account Status**:
   - Verify if the user account has an active status and is not locked or disabled. 

3. **Gather Error Details**:
   - Note the exact error message, when it occurred, and any relevant logs or screenshots.

### Common Issues that Cause This Error
1. **On-Premises Connectivity Issues**:
   - There might be a connectivity failure between Azure AD and your on-premises Active Directory.

2. **DNS Resolution Problems**:
   - DNS settings may be misconfigured, causing failures in connecting to the on-premises environment.

3. **Firewall Blocks**:
   - Firewalls could be preventing the necessary ports for Active Directory connectivity, particularly port 389 for LDAP and port 636 for LDAPS.

4. **Expired Passwords**:
   - An end-user might be attempting to change a password that is already expired but the change cannot reach the on-premises directory.

5. **Network Configuration**:
   - Misconfigured VPNs or network routing can hinder connection attempts from Azure to on-premises systems.

### Step-by-Step Resolution Strategies
1. **Check on-premises Active Directory Health**:
   - Ensure that the active directory domain controllers (DCs) are functional and reachable from the Azure resources, if applicable.

2. **Verify Connectivity from Azure to On-Premises**:
   - Use tools like `ping`, `tracert`, or `telnet` to validate the connectivity to the on-premises servers from Azure. Ensure that necessary ports are open.

3. **Review Azure AD Connect Synchronization**:
   - Check if Azure AD Connect is correctly configured and running. Use the Azure AD Connect Health tool to monitor the synchronization status.
   - Verify that password synchronization is enabled.

4. **Check Firewall Rules**:
   - Review the firewall rules to confirm that they allow traffic between Azure services and the on-premises Active Directory.

5. **Restart Azure AD Connect Service**:
   - Sometimes a simple restart of the Azure AD Connect service can help in re-establishing connectivity.

6. **Check Authentication Methods**:
   - Confirm that proper authentication methods are enabled and correctly configured in Azure AD.

7. **Check Event Logs**:
   - Examine Event Viewer logs on the on-premises domain controllers for any warnings or errors around the time the user attempted to change their password.

### Additional Notes or Considerations
- If multiple users report the same error, it might indicate a broader failure in connectivity or services rather than an individual account issue.
- Ensure users are not behind a VPN that may be blocking necessary traffic or caching credentials incorrectly.

### Documentation Where Steps Can Be Found For Guidance
1. [Microsoft Azure AD Connectivity Errors](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/tshoot-connect-error)
2. [Azure AD Connect Troubleshooting](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/tshoot-connect-install)
3. [Set up Azure AD Connect](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/plan-hybrid-identity)
4. [Active Directory Replication](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/active-directory-replication)

### Test the Documentation is Reachable
- Ensure all links direct to live pages on Microsoft’s documentation site. For example, try accessing [Setting up Azure AD Connect](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/plan-hybrid-identity) to confirm they work.

### Advice for Data Collection
- Collect logs from the Azure AD Connect server for errors or warnings.
- Gather any relevant Event Viewer logs from the on-premises Active Directory domain controllers.
- Document user attempts with timestamps and any other relevant details (e.g., geographic location, network configuration).
- Capture network traces if deeper connectivity analysis is required.

### Conclusion
Troubleshooting the AADSTS120013 error involves a systematic approach to identifying connectivity issues between Azure AD and on-premises Active Directory. By following these steps and utilizing the provided documentation, one can effectively pinpoint and resolve the reason behind this error.