# AADSTS160021: AppSessionSelectionInvalidSessionNotExist - Application requested a user session that doesn't exist. This issue can be resolved by creating new Azure account.


## Troubleshooting Steps
### Troubleshooting Guide for Error Code AADSTS160021

<<<<<<< HEAD
**Error Description**: AADSTS160021 - AppSessionSelectionInvalidSessionNotExist - This error occurs when an application requests a user session that does not exist, indicating a mismatch between what the application is trying to access and the existing user sessions.
=======
#### Initial Diagnostic Steps:
1. **Identify the Application**: Determine which application or service is triggering the error code AADSTS160021.
2. **User Session**: Verify the user session being requested by the application that supposedly doesnï¿½t exist.
3. **Check Azure Account**: Ensure that the Azure account used in the Azure Active Directory (AAD) is correctly configured and has the necessary permissions.
>>>>>>> 44a6fd6d2b08a07d1c083c6d7db8bca24b23c735

---

### Initial Diagnostic Steps

1. **Verify the Error Message**: Ensure that you are indeed encountering the error with the specified code and description.
2. **Check Application Logs**: Review the logs of the application for any additional context or details leading up to the error.
3. **Identify User Accounts**: Confirm the user account attempting to use the application and check its status within the Azure Active Directory (AAD).
4. **Session Validity**: Determine if the session should still be valid by checking its expiration or revocation status.

---

### Common Issues That Cause This Error

1. **Expired Sessions**: Users may have a session that has expired and which needs to be refreshed.
2. **Revoked Permissions**: The application permissions may have been revoked for the user.
3. **Session ID Mismatch**: The application may be attempting to reference a session ID that is no longer valid or has never existed.
4. **Multiple User Accounts**: The user may have multiple Microsoft accounts (work and personal) and is using a different one than expected.
5. **Token Issues**: Problems with the authentication tokens being invalid or expired.

---

### Step-by-Step Resolution Strategies

1. **Create a New Session**:
   - Instruct the user to log out of all sessions of the application.
   - Have the user clear their browser cookies and cache.
   - Ask the user to log back into the application to create a new valid session.

2. **Ensure Correct Account Usage**:
   - Verify that the user is logging in with the correct account associated with the application.
   - Encourage users to switch accounts if they have multiple Microsoft accounts.

3. **Review Application Permissions**:
   - Go to the Azure Portal (https://portal.azure.com).
   - Navigate to **Azure Active Directory** > **App registrations**.
   - Select the application and check the **API permissions**.
   - Ensure that the user or group attempting to access the app has the necessary permissions assigned.

4. **Token Refresh**:
   - In some cases, applications might need to handle token refresh seamlessly. Ensure that the client application has implemented proper token management.
   
5. **Check Application Configuration**:
   - Verify the applications authentication parameters in Azure.
   - Ensure the redirect URIs match those defined in Azure AD.

6. **Check User Session**: 
   - Ensure that there are no old or unnecessary sessions tied to the user in the Azure Active Directory (under **Azure AD > Users**).

7. **Contact Support**: 
   - If these steps do not resolve the issue, proceed to gather detailed error logs and contact Microsoft support for further assistance.

---

### Additional Notes or Considerations

- **Browser Compatibility**: Ensure that the users browser is up to date and clear any cached data as web applications may be sensitive to older versions or corrupted caches.
- **Network Policies**: Verify that corporate network or firewall policies are not blocking the authentication requests.
- **Directory Sync Issues**: Ensure that if using on-premises Active Directory, sync is functioning properly with Azure AD.

---

### Documentation for Guidance

- **Azure Active Directory Documentation**: 
  - [Managing user sessions in Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-net-application-configuration#user-sessions)
  - [Error codes in Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/develop/reference-aad-errors)
  - [How to troubleshoot sign-in errors](https://docs.microsoft.com/en-us/azure/active-directory/user-help/user-help-authentication-error-messages)

---

### Test Documentation Reachability

- Check the links to ensure they direct to valid pages. You can use a browser to visit the URLs provided above and confirm their accessibility.

---

### Advice for Data Collection

- **Error Logs**: Always collect detailed error logs from both the application and Azure AD to help diagnose the issue further.
- **User Environment**: Gather information on the user's environment, including browser type/version and operating system.
- **Session Information**: Log the session IDs being passed to see if they correlate with known session records.

This guide should help you diagnose and resolve the AADSTS160021 error effectively. If further complications arise, reaching out to Microsoft support may be necessary.

Category: Other