# AADSTS9001023: The grant type isn't supported over the /common or /consumers endpoints. Please use the /organizations or tenant-specific endpoint.


## Troubleshooting Steps
### Troubleshooting Guide for AADSTS9001023 Error Code

**Error Description**:  
The error code AADSTS9001023 indicates that the grant type being used to request a token is not supported over the /common or /consumers endpoints in Azure Active Directory (Azure AD). It suggests that you should use the /organizations or a tenant-specific endpoint instead.

---

### Initial Diagnostic Steps

1. **Identify the Endpoint Used**:
   - Check the Azure AD endpoint being used in your application (e.g., `/common`, `/consumers`, `/organizations`, or tenant-specific URLs).

2. **Review the Grant Type**:
   - Review the specific OAuth 2.0 grant type being utilized in the request (e.g., Authorization Code, Client Credentials, etc.) to confirm if it is supported on the endpoint used.

3. **Check Application Registration**:
   - Verify that the application is registered correctly in the Azure portal and that it has the appropriate permissions and settings.

---

### Common Issues that Cause This Error

1. **Using the Wrong Endpoint**:
   - Common and consumers endpoints do not support certain grant types, particularly those associated with enterprise applications.

2. **Misconfigured Application Settings**:
   - Incorrect application type or permissions set in the Azure portal can result in this error.

3. **Token Permissions**:
   - The application might not have the necessary API permissions configured to allow the desired grant type.

4. **Tenant-Specific Endpoint Missing**:
   - If you are trying to authenticate users in a specific tenant and use the `/common` endpoint, the request will fail.

---

### Step-by-Step Resolution Strategies

1. **Switch to the Correct Endpoint**:
   - If your application is intended for organizational users only, change the authentication requests to use `/organizations` instead of `/common`.
   - Alternatively, use a tenant-specific endpoint that includes the tenant ID or domain name, e.g., `https://login.microsoftonline.com/{tenantId}`.

   Example:
   - Incorrect: `https://login.microsoftonline.com/common/oauth2/v2.0/token`
   - Correct: `https://login.microsoftonline.com/{tenantId}/oauth2/v2.0/token`

2. **Verify Grant Type Compatibility**:
   - Consult the [Microsoft Identity Platform documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow) for grant types supported by the chosen endpoint. Ensure you are utilizing a grant type that is supported by the organizations or tenant-specific endpoints.

3. **Check Application Registration Settings**:
   - Go to the Azure portal, navigate to Azure Active Directory > App registrations > Your App.
   - Confirm that the application type is appropriate (e.g., Web, Native) and that permissions are accurately set up.

4. **Review Required Permissions**:
   - Go to API permissions in your Azure app registration and ensure all required permissions for the selected grant type are correctly configured and granted.

5. **Test and Validate**:
   - After applying the changes, attempt to authenticate again and check if the issue persists.

---

### Additional Notes or Considerations

- Using the `/common` endpoint allows any Azure AD or Microsoft account user to authenticate, but since it lacks tenant-specific configuration, it may not support all functionalities required in enterprise scenarios.
- If using multiple tenants, switch to a tenant-specific endpoint for each of those tenants.
- Consider implementing proper error handling in your application to give users clearer messages regarding endpoint issues.

---

### Documentation Links

- **Azure Authentication Overview**: [Microsoft Docs - Authentication](https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-scenarios)
- **OAuth2 Authorization Code Flow**: [Microsoft Docs - OAuth2/Authorization Code Flow](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow)
- **Application Registration Tutorial**: [Microsoft Docs - Register an Application](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)

**Note**: Check these links directly to ensure they are reachable and up to date.

---

### Advice for Data Collection

- Collect logs from the application that attempts authentication, focusing on the request and response bodies, especially the endpoint used and any parameters included.
- Capture the exact error response received when the error occurs, as it helps in pinpointing the issue quickly.
- Compile environment-specific details (e.g., tenant ID, application ID, and any specific configurations) that might influence your authentication setup.

Using this comprehensive troubleshooting guide, you should be able to systematically diagnose and resolve the AADSTS9001023 error in your application.

Category: Other