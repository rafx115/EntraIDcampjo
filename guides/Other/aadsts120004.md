# AADSTS120004: PasswordChangeOnPremComplexity


## Troubleshooting Steps
### Troubleshooting Guide for AADSTS120004 Error: PasswordChangeOnPremComplexity

The error code AADSTS120004 indicates that a user attempted to change their password, but the complexity requirements set for their on-premises Active Directory environment were not met. This usually occurs in hybrid environments where both Azure Active Directory (AAD) and on-premises Active Directory are in use.

---

#### Initial Diagnostic Steps

1. **Identify the User Reporting the Error:**
   - Gather information about the user who encountered the error. Note their username, the time of the error, and any relevant context (e.g., which application was used, method of password change).

2. **Check User's Last Password Change:**
   - Determine when the user last updated their password and whether there were any issues at that time.

3. **Review Password Complexity Policies:**
   - Check the password complexity requirements enforced by the organization's Active Directory settings.

---

#### Common Issues that Cause This Error

1. **Password Complexity Requirements Not Met:**
   - The new password may not meet the complexity policies (length, character variety, etc.).

2. **Inconsistent Policies Across Environments:**
   - Complexity requirements enforced on-premises may differ from those in Azure AD.

3. **Account Lockout or Expiry:**
   - The account might be locked or the password expired.

4. **Sync Issues:**
   - Issues in synchronization between Azure AD and on-premises AD.

---

#### Step-by-Step Resolution Strategies

1. **Review and Understand Password Policies:**
   - Go to **Active Directory Users and Computers**:
     - Right-click on the domain, select **Properties**.
     - Under the **Group Policy** tab, find the policy that includes password complexity requirements (e.g., "Default Domain Policy").
   - Check the specified requirements, such as:
     - Minimum length (typically 8 characters).
     - Required mix of uppercase letters, lowercase letters, numbers, and special characters.

2. **User Must Create a Compliant Password:**
   - Inform the user of the complexity requirements and have them attempt to change their password while ensuring it meets all requirements.

3. **Use PowerShell to Verify Policy:**
   - Open the Active Directory PowerShell console and run:
     ```powershell
     Get-ADDefaultDomainPasswordPolicy
     ```
   - Review policy settings such as `MinPasswordLength`, `PasswordComplexityEnabled`, etc.

4. **Monitor for Sync Issues:**
   - Ensure Azure AD Connect is functioning properly:
     - Check synchronization status in the Azure AD Connect tool.
     - Run a manual synchronization if necessary using:
       ```powershell
       Start-ADSyncSyncCycle -PolicyType Delta
       ```
   - Verify that users are correctly syncing their password changes.

5. **Account Status Verification:**
   - In Active Directory, check if the user's account is disabled or locked. If necessary, unlock or enable the user.

6. **Testing Changes:**
   - After adjustments, ask the user to attempt a password change again and verify if the issue persists.

---

#### Additional Notes or Considerations

- **User Education:** Inform users about creating strong passwords that comply with complexity requirements.
- **Error Logs:** Regularly review logs from your identity management and Azure services to catch similar issues early.
<<<<<<< HEAD:guides/Other/aadsts120004.md
- **Regular Policy Review:** Ensure that the complexity requirements are updated as per the organizations security policy.
=======
- **Regular Policy Review:** Ensure that the complexity requirements are updated as per the organization�s security policy.
>>>>>>> 8ca1440664e61dbdf9b1aa83f352634474c59c2f:guides/aadsts120004.md

---

#### Documentation for Further Guidance

- For more information on managing password policies:
  - Microsoft Documentation on Password Policy: [Password Policy](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/group-policy/manage-password-policy)
  
- For troubleshooting Azure AD errors:
  - Microsoft Troubleshooting AAD: [Troubleshoot Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/enterprise-users/users/groups-troubleshoot)

- **Testing Documentation Accessibility:**
  - Ensure that the above links are reachable and functioning as expected.

---

#### Advice for Data Collection

- **User Feedback:** Keep notes about what the user attempted (new passwords, methods used).
- **Error Details:** Document specifics of the error code and any messages.
- **Environment Information:** Collect information on the environment such as Azure AD Connect version, AD policy settings, and synchronization logs.

By following this guide, the issue with error code AADSTS120004 should be resolvable in most cases. Always ensure users are informed and provided with adequate support.

Category: Other