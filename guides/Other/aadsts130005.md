# AADSTS130005: NgcInvalidSignature - NGC key signature verified failed.


## Troubleshooting Steps
## Troubleshooting Guide for AADSTS130005 - NGC Invalid Signature 

### Overview of AADSTS130005
The AADSTS130005 error with the description "NgcInvalidSignature - NGC key signature verified failed" typically indicates that there is a problem with the signature verification of keys used in the Next Generation Credential (NGC) authentication process. This usually occurs within Azure Active Directory (Azure AD) or when interacting with services that rely on Azure AD authentication.

### Initial Diagnostic Steps
1. **Check for Service Outages:**
   - Verify if there are any ongoing outages or incidents affecting Azure AD services using the [Azure Status Page](https://status.azure.com/en-us/status).

2. **Review Event Logs:**
   - Collect logs from the client application, including authentication-related logs and any detailed error messages. This data can help identify patterns or specific failures.

3. **Check User Information:**
   - Confirm the user account has appropriate configurations and permissions set up in Azure AD.

4. **Validate Device Certificate:**
   - Ensure that the device attempting authentication has a valid and recent certificate. Device certificates can expire or become invalidated over time.

### Common Issues That Cause This Error
1. **Expired or Invalid Certificates:**
   - The certificates used for signing might have expired or been revoked.

2. **Mismatch Between NGC Keys:**
   - There may be a mismatch between the NGC keys on the client device and those stored in Azure AD.

3. **Corrupted Authentication Cache:**
   - Local cache files may become corrupted, leading to failed authentication attempts.

4. **Clock Skew:**
   - The system clock on the client device may be out of sync with the server time, which can impact signature verification.

5. **Group Policies:**
   - Certain group policies could affect the generation or handling of NGC keys.

### Step-by-Step Resolution Strategies
#### Step 1: Check Certificate Validity
- Use the Certmgr.msc tool or equivalent to check the expiration date of the relevant certificates on the client device. Update or renew any that have expired.

#### Step 2: Clear Authentication Cache
- Clear any cached credentials and authentication details. You can do this through:
  - Windows Settings > Accounts > Access work or school > [Account] > Disconnect
  - Use the command `cmdkey /list` to review and remove any stored credentials tied to Azure.

#### Step 3: Synchronize System Time
- Ensure that the system time on the client device is synchronized with an internet time server:
  - Control Panel > Date and Time > Internet Time > Change settings.

#### Step 4: Re-enroll Device with Azure AD
- If issues persist, consider unjoining the device from Azure AD and then re-enrolling it:
  - Go to Settings > Accounts > Access work or school > Disconnect and then reconnect it.

#### Step 5: Check Group Policy Settings
- Review any relevant group policies that might impact device authentication and key management:
  - Open the Group Policy Editor, and navigate to `Computer Configuration > Administrative Templates > System/Group Policy`.

#### Step 6: Update Client Applications
- Ensure that all client applications interacting with Azure AD are up to date.

### Additional Notes or Considerations
- Make sure that the user has re-registered for NGC on the device if they have recently changed their password or policy settings, as this could affect their authentication tokens.
- Consider the impact of any recent changes in Azure AD settings, especially regarding conditional access, which might limit access under certain criteria.

### Documentation for Guidance
For more in-depth information, consider referencing the following resources:
- [Microsoft Identity Platform Documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/)
- [Azure AD Error Code Reference](https://docs.microsoft.com/en-us/azure/active-directory/develop/reference-aadsts-error-codes)

### Testing Documentation Access
To test the documentation access:
1. Open a web browser and visit [Microsoft Identity Platform Documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/).
2. Verify that the page loads correctly and contains the expected content on error codes.

### Advice for Data Collection
When collecting data for troubleshooting:
- Gather detailed logs from both the client application and Azure AD.
- Include timestamps for specific error occurrences.
- Capture any user actions preceding the error.
- Document any configurations adjusted during troubleshooting efforts for future reference.

By following this guide, you should be able to identify and resolve issues related to the AADSTS130005 error efficiently.

Category: Other