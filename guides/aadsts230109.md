# AADSTS230109: CachedCredentialNonGWAuthNRequestsNotSupported - Backup Auth Service only allows AuthN requests from Microsoft Entra Gateway. This error is returned when traffic targets the backup auth service directly instead of going through the reverse proxy.


## Introduction

This guide will help resolve issues related to
cachedcredentialnongwauthnrequestsnotsupported - backup auth service only allows

authn requests from microsoft entra gateway. this error is returned when traffic
targets the backup auth service directly instead of going through the reverse
proxy..


## Prerequisites


* Access to the Azure AD portal with administrator privileges.

* The user must have already set up MFA.


## Steps to Resolve


### Step 1: Initial Actions

1. Log in to the Azure AD portal.
2. Navigate to the "Users" section.
3. Select the affected user.
4. Perform necessary actions as described for the error.


### Step 2: Verify MFA Settings

1. Ensure that the user has MFA configured.
2. If necessary, guide the user through the MFA setup process.


## Troubleshooting


* Check for any Azure AD conditional access policies that might be affecting the

  MFA process.

* Consider any additional security measures that might be in place.


## Additional Notes


* Refer to the

  [Azure AD 
documentation](https://learn.microsoft.com/en-us/azure/active-directory/)
  for more details.


## Troubleshooting Steps

Troubleshooting steps could not be generated due to an error.


## Troubleshooting Steps

Troubleshooting steps could not be generated due to an error.


## Troubleshooting Steps

Here is a detailed troubleshooting guide for the error code AADSTS230109 -
CachedCredentialNonGWAuthNRequestsNotSupported:

**Initial Diagnostic Steps:** 

1. **Confirm the Error Code:** Make sure that the error code you are facing is

   indeed AADSTS230109.
2. **Check System Configuration:** Review the architecture and setup of your

   authentication system to identify if there is a direct connection to the
   backup auth service bypassing the reverse proxy.
3. **Check Network Logs:** Analyze network logs to see the flow of

   authentication requests and identify any direct traffic targeting the backup
   auth service.

**Common Issues that Cause this Error:** 

1. **Misconfigured Network Routing:** The traffic might be directly reaching the

   backup auth service due to misconfigured network routing settings.
2. **Bypassing Reverse Proxy:** Authentication requests not going through the

   reverse proxy as expected can trigger this error.
3. **Outdated Settings:** Changes in network or authentication configurations

   without updating the system settings could lead to this issue.

**Step-by-Step Resolution Strategies:** 

1. **Review Network Configuration:** 

   * Ensure that the network route for authentication requests is set up to go

     through the reverse proxy.
   * Check if there are any routing rules that might be causing direct traffic

     to the backup auth service.

2. **Update Reverse Proxy Settings:** 

   * Verify the reverse proxy settings and make sure they are correctly

     configured to handle all authentication traffic.
   * Adjust any settings that might be preventing traffic from reaching the

     backup auth service via the reverse proxy.

3. **System Update and Patch:** 

   * Check for any system updates or patches that might address this specific

     error code.
   * Apply any recommended updates to ensure the system is up to date with the

     latest fixes.

4. **Test Authentication Flow:**    * Conduct tests to validate that 
authentication requests are now successfully

     passing through the reverse proxy.
   * Monitor network logs and verify that traffic is being directed as expected.

**Additional Notes or Considerations:**


* **Security:** Ensure that proper security measures are in place, especially

  when redirecting authentication traffic.

* **Documentation:** Keep track of any changes made to the network or

  authentication settings for future reference.

* **Training:** Provide training to the relevant personnel to avoid

  misconfigurations that lead to this type of error.

Following these steps should help in troubleshooting and resolving the
AADSTS230109 error related to CachedCredentialNonGWAuthNRequestsNotSupported. If
the issue persists, consider reaching out to your organization's IT support or
Microsoft support for further assistance.