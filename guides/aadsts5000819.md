# AADSTS5000819: InvalidSamlTokenEmailMissingOrInvalid - SAML Assertion is invalid. Email address claim is missing or doesn't match domain from an external realm.


## Introduction

This guide will help resolve issues related to
invalidsamltokenemailmissingorinvalid - saml assertion is invalid. email address

claim is missing or doesn't match domain from an external realm..


## Prerequisites


* Access to the Azure AD portal with administrator privileges.

* The user must have already set up MFA.


## Steps to Resolve


### Step 1: Initial Actions

1. Log in to the Azure AD portal.
2. Navigate to the "Users" section.
3. Select the affected user.
4. Perform necessary actions as described for the error.


### Step 2: Verify MFA Settings

1. Ensure that the user has MFA configured.
2. If necessary, guide the user through the MFA setup process.


## Troubleshooting


* Check for any Azure AD conditional access policies that might be affecting the

  MFA process.

* Consider any additional security measures that might be in place.


## Additional Notes


* Refer to the

  [Azure AD 
documentation](https://learn.microsoft.com/en-us/azure/active-directory/)
  for more details.


## Troubleshooting Steps

Troubleshooting steps could not be generated due to an error.


## Troubleshooting Steps

Troubleshooting steps could not be generated due to an error.


## Troubleshooting Steps

**Error Code AADSTS5000819: InvalidSamlTokenEmailMissingOrInvalid**

**Initial Diagnostic Steps:** 

1. Verify the specific circumstances under which the error occurs to understand
   the impact.
2. Check if the error is consistently happening for all users or specific users.
3. Ensure there have been no recent changes to the SAML configuration that could
   have led to this error.
4. Review the SAML assertion details and the external realm settings.

**Common Issues that Cause this Error:** 

1. Missing email address claim in the SAML assertion.
2. Email address in the SAML assertion does not match the required domain.
3. Configuration mismatch between the Identity Provider (IdP) and Azure AD
   settings.
4. Issues with the mapping of attributes between IdP and Azure AD.

**Step-by-Step Resolution Strategies:** 

1. **Check SAML Assertion:** 

   * Ensure that the SAML assertion includes the email address claim.

   * Verify that the email address claim matches the domain set in the Azure AD

     configuration.

2. **Review IdP Configuration:** 

   * Confirm that the Identity Provider is configured to provide the email

     address claim in the SAML assertion.
   * Check if there have been any changes in the IdP settings that might have

     caused the email address to be missing or invalid.

3. **Update Azure AD Settings:** 

   * Adjust the Azure AD configuration to align with the email address claim

     provided by the IdP.
   * Make sure the domain specified in Azure AD matches the domain of the email

     address in the SAML assertion.

4. **Attribute Mapping:**    * Verify the attribute mapping between the IdP and 
Azure AD to ensure the

     email address claim is correctly mapped.
   * Update the attribute mapping in Azure AD if needed to match the email

     address claim.

**Additional Notes or Considerations:**


* After making any changes to the configuration, test the SAML assertion flow to

  check if the error persists.

* Consider involving your IT support team or the support teams of the IdP and

  Azure AD for further assistance if needed.

* Document any changes made for future reference and troubleshooting purposes.

By following these troubleshooting steps, you can address the AADSTS5000819
error related to an InvalidSamlTokenEmailMissingOrInvalid issue effectively.