
# AADSTS500021: Access to '{tenant}' tenant is denied. AADSTS500021 indicates that the tenant restriction feature is configured and that the user is trying to access a tenant that isn't in the list of allowed tenants specified in the headerRestrict-Access-To-Tenant. For more information, seeUse tenant restrictions to manage access to SaaS cloud applications.


## Troubleshooting Steps
Certainly! Here is a detailed troubleshooting guide for the error code AADSTS500021, which indicates that access to a specific tenant is denied due to tenant restrictions in place.

---

# Troubleshooting Guide for AADSTS500021

## **Error Code Description**
**AADSTS500021**: The error means that access to the specified tenant is denied because the user is trying to access a tenant that isn't in the list of allowed tenants defined by the tenant restriction settings.

## **Initial Diagnostic Steps**
1. **Check User Identity**: Confirm the identity of the user attempting to log in. Gather information on their Azure Active Directory (AAD) attributes.
2. **Identify the Tenant**: Determine which tenant the user is attempting to access, and make sure they are within the organization’s tenant.
3. **Review Access Policies**: Check if user access policies or conditions are enforced in Azure AD that could restrict access to specific tenants.

## **Common Issues That Cause This Error**
1. **Tenant Restrictions**: The tenant restriction feature is enabled, and the user is not part of the allowed tenants.
2. **Incorrect Tenant ID in Request**: The tenant ID specified in the request may not match any of the allowed tenants.
3. **User Not Assigned to the Application**: The user may not be assigned to the application being accessed within the allowed tenant.
4. **Conditional Access Policies**: There might be conditional access policies that prevent access based on user state or location.

## **Step-by-Step Resolution Strategies**

### 1. **Validate Tenant Restrictions**
   - Go to your Azure portal.
   - Navigate to **Azure Active Directory** > **Enterprise applications** > **User settings**.
   - Check the configuration under **Restrict access to specific tenants**. Ensure that the user's tenant is listed here.

### 2. **Check User Permissions**
   - Ensure the user has been granted the appropriate roles or permissions to access the application in the tenant.
   - Navigate to **Azure Active Directory** > **Users** > Select the user > **Assigned Roles** to verify.

### 3. **Review Application Settings**
   - Confirm that the application the user is trying to access is listed in the allowed applications for their tenant.
   - Under **Azure Active Directory**, go to **Enterprise applications** and check the application's settings.

### 4. **Modify Access Restrictions (if applicable)**
   - If the restriction is being applied that you wish to change, you can modify it in the **User settings** under **Restrict access to specific tenants**.
   - Add the tenant(s) you want to allow.

### 5. **Consider Conditional Access Policies**
   - Review any conditional access policies in place that could affect access. Go to **Azure Active Directory** > **Security** > **Conditional Access** and examine any policies that may block access based on the user's context.

## **Additional Notes or Considerations**
- Tenant restrictions are primarily used in organizations that manage multiple tenants for security reasons.
- Testing access using a different user account or an incognito mode can help determine if the issue is user-specific.
- Keep security considerations in mind when modifying tenant restrictions.

## **Documentation for Guidance**
- Microsoft documentation on [Using tenant restrictions to manage access to SaaS cloud applications](https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/groups/groups-tenant-restrictions)
- Guidance on [Conditional Access](https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/overview)

### **Test Documentation Accessibility**
To ensure that these documents are accessible, perform the following:
1. Click on the links provided above to check their loading status.
2. Ensure your browser settings allow access to external sites.

## **Advice for Data Collection**
- **Event Log**: Collect Azure AD sign-in logs for the user which can be found in Azure AD > Sign-ins. Look for entries related to the failed sign-in attempt with AADSTS500021.
- **Network Trace**: Consider running a network trace using developer tools in your browser to view the headers and responses returned during the failed request.
- **User Feedback**: Document specific actions the user was performing at the time of the error for context.

## **Conclusion**
Following this guide will help identify and resolve the AADSTS500021 error by correctly configuring tenant restrictions and validating user permissions. Always ensure that security measures are in alignment with organizational policies during the troubleshooting process.

--- 

This guide should serve as a comprehensive resource for troubleshooting and resolving the AADSTS500021 error effectively.