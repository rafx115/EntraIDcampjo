# AADSTS900561: BadResourceRequestInvalidRequest - The endpoint only accepts {valid_verbs} requests. Received a {invalid_verb} request. {valid_verbs} represents a list of HTTP verbs supported by the endpoint (for example, POST), {invalid_verb} is an HTTP verb used in the current request (for example, GET). This can be due to developer error, or due to users pressing the back button in their browser, triggering a bad request. It can be ignored.


## Troubleshooting Steps
# Troubleshooting Guide for AADSTS900561: BadResourceRequestInvalidRequest Error

The AADSTS900561 error indicates that the endpoint received an HTTP request using an invalid method (verb) such as GET when it only accepts specific methods like POST. This type of error can occur for various reasons, including developer mistakes or users interacting improperly with the application.

## Initial Diagnostic Steps

1. **Identify the Request Method Used**: Check your application logs to determine which HTTP method (verb) was used in the request that led to the error. 
2. **Reference the API Documentation**: Look at the specific API documentation for the endpoint you are trying to access. Note the valid HTTP verbs listed there.
3. **Review User Actions**: Determine if users are performing any actions that may lead to invalid requests, such as hitting "back" in the browser.

## Common Issues That Cause This Error

1. **Incorrect HTTP Method**: The most common cause is using the wrong HTTP method for the endpoint. 
2. **User Interaction**: Users may inadvertently cause this error by refreshing or going back in their browser after submitting a form. 
3. **Misconfigured Client-Side Code**: The client-side code (JavaScript or other languages) may be incorrectly sending requests with invalid methods. 
4. **API Versioning**: If you recently updated your API or made changes to its structure, older versions may still be using outdated HTTP methods.

## Step-by-Step Resolution Strategies

### Step 1: Verify the HTTP Method
- Check the specific endpoint you are trying to access. Review its documentation in detail to ensure that you are using the correct HTTP verb.
  
### Step 2: Modify Application Code
- If you are using a programming language, adjust your code to utilize the correct verb. For instance, change from:
  ```javascript
  fetch('https://example.com/api/endpoint', {
      method: 'GET' // Change this to the correct method, e.g. POST
  });
  ```
  to:
  ```javascript
  fetch('https://example.com/api/endpoint', {
      method: 'POST' // Use the valid method as per documentation
  });
  ```

### Step 3: Handle User Interactions
- Implement checks in your frontend to handle actions that may trigger bad requests. For example, disable form submissions after the first click, prevent re-submissions, or use JavaScript history management techniques.

### Step 4: Review API Changes
- Check with your team to see if any recent changes were made to the API that could affect which HTTP verbs are allowed.

### Step 5: Test Again
- After making the necessary changes, retest the API request. Monitor logs for any further instances of the error.

## Additional Notes or Considerations

- **User-Friendly Error Handling**: Consider implementing user-friendly error messages that guide users on what they should or should not do when using the application.
- **Retry Logic**: Implement retry logic for network requests where applicable, to handle transient issues.
- **Debugging Tools**: Utilize tools like Postman or cURL to test API requests independently of the application.
- **Logging**: Enhance logging to capture the raw request details and the specific response from the API for better analysis in the future.

## Documentation for Reference

- For details about valid HTTP verbs supported by Azure AD, see the official Azure AD documentation:
  - [Azure Active Directory Documentation](https://docs.microsoft.com/en-us/azure/active-directory/)

## Test the Documentation Reachability
To confirm the documentation is reachable, visit the link above and verify that it loads correctly in your browser. 

## Advice for Data Collection

- Collect the following data when reporting this error:
  - The exact request URL to the API.
  - The HTTP method used.
  - The full response received (including headers).
  - Steps to replicate the issue through user actions.
  - Context about any recent code changes or deployments.
- Providing this data will help in diagnosing any recurring issues more effectively.

By following this troubleshooting guide, you should be able to identify and resolve the AADSTS900561 error effectively.