# AADSTS130004: NgcKeyNotFound - The user principal doesn't have the NGC ID key configured.

## Introduction

This guide will help resolve issues related to ngckeynotfound - the user
principal doesn't have the ngc id key configured..

## Prerequisites

* Access to the Azure AD portal with administrator privileges.
* The user must have already set up MFA.

## Steps to Resolve

### Step 1: Initial Actions

1. Log in to the Azure AD portal.
2. Navigate to the "Users" section.
3. Select the affected user.
4. Perform necessary actions as described for the error.

### Step 2: Verify MFA Settings

1. Ensure that the user has MFA configured.
2. If necessary, guide the user through the MFA setup process.

## Troubleshooting

* Check for any Azure AD conditional access policies that might be affecting the
  MFA process.
* Consider any additional security measures that might be in place.

## Additional Notes

* Refer to the
  [Azure AD documentation](https://learn.microsoft.com/en-us/azure/active-directory/)
  for more details.

## Troubleshooting Steps

Troubleshooting steps could not be generated due to an error.

## Troubleshooting Steps

Troubleshooting steps could not be generated due to an error.

## Troubleshooting Steps

**Troubleshooting Guide for Error Code AADSTS130004 - NgcKeyNotFound:**

**Initial Diagnostic Steps:**

1. **Identify the User:** Verify the user experiencing the issue and gather
   information about any recent changes to their account or device.

2. **Check NGC ID Key Configuration:** Confirm if the NGC ID key is properly
   configured for the user principal in the Azure Active Directory settings.

3. **Review Error Logs:** Look for any additional information in the error logs
   related to the issue to understand the context of the error.

**Common Issues that Cause this Error:**

1. **NGC ID Key Missing:** The user's NGC ID key may not be configured or is
   missing in the Azure Active Directory settings.

2. **Network Issues:** Connectivity problems or network configurations blocking
   access to the NGC ID key service may also lead to this error.

3. **Incorrect Azure AD Configuration:** Misconfigured Azure AD settings related
   to Windows Hello for Business or NGC authentication methods can cause this
   error.

**Step-by-Step Resolution Strategies:**

1. **Reconfigure NGC ID Key:**

   * In Azure AD, navigate to the user's profile.
   * Ensure that the NGC ID key is correctly configured for the user.
   * If missing or incorrect, reconfigure the NGC ID key following Azure AD
     guidelines.

2. **Validate NGC Authentication Method:**

   * Check if the correct NGC authentication method is selected for the user.
   * Verify that Windows Hello for Business or other NGC methods are
     appropriately set up.

3. **Network Connectivity:**

   * Confirm that the device has proper network connectivity to access the NGC
     ID service.
   * Ensure that firewalls or network settings are not blocking the NGC ID key
     retrieval.

4. **Update Azure AD Settings:**
   * Review and update Azure AD configuration settings related to NGC
     authentication methods.
   * Make sure all required configurations for NGC keys are in place.

**Additional Notes or Considerations:**

* **User Training:** Provide user training on the correct setup and usage of NGC
  authentication methods.
* **Azure Support:** If the issue persists, consider reaching out to Azure
  support for further assistance in troubleshooting the NGC ID key configuration
  problem.
* **Regular Auditing:** Regularly audit and monitor NGC ID key configurations to
  ensure they remain correctly set up for users.

By following these troubleshooting steps, you should be able to identify and
resolve the error code AADSTS130004 related to NgcKeyNotFound effectively.
