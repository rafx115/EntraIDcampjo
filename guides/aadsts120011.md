
# AADSTS120011: PasswordChangeAsyncUpnInferenceFailed


## Troubleshooting Steps
### Troubleshooting Guide for AADSTS120011: PasswordChangeAsyncUpnInferenceFailed

The error code AADSTS120011 indicates that there was a failure in inferring the User Principal Name (UPN) during a password change operation in Azure Active Directory (AAD). This error usually surfaces when there is an issue with the user's identity or their account configuration in Azure AD.

#### Initial Diagnostic Steps
1. **Verify User Credentials:**
   - Ensure that the user is entering the correct username and password.
   - Check if there are any typos or incorrect case in the UPN.

2. **Check User Account Status:**
   - Log into the Azure portal and verify the user's account status (Active, Disabled, Locked out).
   - Ensure the user exists in Azure AD and there's no deletion or migration that might have affected their UPN.

3. **Inspect Azure AD Settings:**
   - Check the configuration of Azure AD Connect if used. Ensure that synchronization is happening properly.
   - Verify that the UPN and other attributes are set correctly in the on-premises Active Directory if applicable.

4. **Review Logs:**
   - Look into Azure AD audit logs for details related to password changes or authentication errors for the specific user. 

#### Common Issues that Cause This Error
1. **Incorrect UPN Format:**
   - The user is trying to change the password without the correct UPN format (e.g., missing domain).
  
2. **Account Provisioning Issues:**
   - The user account might not be fully provisioned, or there may be discrepancies during the synchronization process.

3. **Identity Synchronization Problems:**
   - Issues during the synchronization between on-premises Active Directory and Azure AD can lead to mismatches and errors in account attributes.

4. **Password Change Restrictions:**
   - Policies in place that restrict how and when passwords can be changed might impact functionality.

#### Step-by-Step Resolution Strategies
1. **Revalidate User UPN:**
   - Confirm that the UPN used to change the password is correctly entered and matches the format `user@domain.com`.

2. **Check Synchronization Status:**
   - If using Azure AD Connect:
     - Open the Azure AD Connect tool on your server.
     - Ensure synchronization is successful and review any synchronization errors.
     - Force synchronization using PowerShell: 
       ```powershell
       Start-ADSyncSyncCycle -PolicyType Delta
       ```

3. **User Provisioning:**
   - If the user's account was just created or imported, ensure that:
     - All required attributes (like UPN) are entered correctly.
     - The user's status in Azure AD is active.

4. **Modify User Attributes:**
   - If you find issues with the UPN or other attributes:
     - Navigate to Azure Active Directory > Users > [Select User] > Edit.
     - Make necessary changes to UPN or associated attributes.

5. **Review and Update Password Policies:**
   - Ensure that the password change policies are correctly configured without restrictions causing failures.
   
6. **Contact Microsoft Support:**
   - If the problem persists, gather logs and contact Microsoft support for further investigation.

#### Additional Notes or Considerations
- Confirm that the user is not in an environment where multi-factor authentication policies interfere with password change requests.
- Look into recent changes in the infrastructure that may have impacted how accounts synchronize or authenticate.
- Check if recent updates may have impacted Azure AD services.

#### Documentation References
- [Azure Active Directory Password Management](https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-password-management)
- [Azure AD Connect synchronization](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/whatis-hybrid-identity)
- [Troubleshooting AAD User Sign-in Issues](https://docs.microsoft.com/en-us/azure/active-directory/enterprise-users/groups/active-directory-aad-groups)

#### Test Documentation Accessibility 
You can verify whether the provided documentation links are accessible by visiting each URL in a web browser.

#### Advice for Data Collection
- **Gather Logs:**
  - Collect the Azure AD sign-in logs for the user experiencing the issue.
  - Capture any relevant error codes and messages when attempting the password change.
  
- **Feedback from Users:**
  - If multiple users are having similar issues, compile their information, such as account conditions and attempted operations.

- **Azure AD Connect Logs:**
  - If using Azure AD Connect, check the server hosting this service for logs related to synchronization and health. 

With these steps, you should be able to diagnose and potentially resolve the AADSTS120011 error effectively.