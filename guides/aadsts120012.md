# AADSTS120012: PasswordChangeNeedsToHappenOnPrem


## Troubleshooting Steps
Sure! Here is a detailed troubleshooting guide for the error code **AADSTS120012** with the description **PasswordChangeNeedsToHappenOnPrem**.

### 1. Initial Diagnostic Steps

When this error occurs, it usually means that the user's password needs to be changed on-premises (such as in Active Directory) rather than through Azure AD. Here are the steps to diagnose the situation:

- **Verify User's Account Type:** Determine whether the user is a cloud-only account or a synchronized account from an on-premises Active Directory.
  
- **Check for Alerts:** Look in Azure AD for any alerts or messages relevant to the account that might suggest the need for a password change.

- **Confirm Previous Activity:** Check if the user has recently changed their password, if so, this could cause the error depending on how synchronization is configured.

### 2. Common Issues that Cause This Error

- **Password Change Requirement:** The user's password might have expired, or they may be required to change their password after a certain time period.

- **Synchronization Issues:** If the user's account is synchronized with an on-premises directory, there could be issues with the synchronization process.

- **Endpoint Policy:** An account policy might be set to require users to change their password on-premises.

- **Federated Authentication:** If the account is federated with ADFS or another identity provider, the password change needs to be handled on-premises.

### 3. Step-by-Step Resolution Strategies

Here are the steps you can take to resolve this error:

#### Step 1: Direct User to Change Password on-Premises
1. Instruct the user to go to their on-premises environment (such as a corporate network or VPN) where they can access the organization's internal systems.
2. Have them perform a password change on their domain account.

#### Step 2: Check Synchronization (if applicable)
1. If the user account is synchronized with Azure AD, ensure that Azure AD Connect is functioning correctly.
2. Verify that changes made on-premises are reflecting in Azure AD. You can use tools such as Azure AD Connect Health to monitor the synchronization status.

#### Step 3: Investigate Password Policies
1. Review your organization's password policies and ensure they are not overly restrictive.
2. Check if the policies require changes to be made on-premises for any specific groups of users.

#### Step 4: Review Federation Setup (if applicable)
1. If you have a federated setup (e.g., ADFS), confirm that the federation is set up correctly and that users are redirected appropriately for password changes.
2. If necessary, refer to documentation for the identity provider being used for federation.

### 4. Additional Notes or Considerations

- Ensure that all IT personnel are aware of any changes to password policies that could impact users.
- Keep communication open with users regarding where they need to perform administrative tasks, especially in a hybrid environment.
- Monitor user feedback to identify if this is a recurrent issue.

### 5. Documentation Reference for Guidance

- [Microsoft Docs - Troubleshoot Azure AD authentication issues](https://docs.microsoft.com/en-us/azure/active-directory/develop/troubleshoot-authentication)
- [Azure AD Connect: How to troubleshoot sign-in issues](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/tshoot-connect-health)
- [Change your password in Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/user-help/user-help-password-reset)

**Test Documentation Reachability:**
- Make sure to visit the links above to confirm they are reachable and contain the expected guidance.

### 6. Advice for Data Collection

- **User Details:** Collect information about the user experiencing the issue, including their account type (cloud-only or synchronized), group memberships, and any recent activities.
  
- **Log Files:** Review Azure AD sign-in logs and any relevant synchronization logs from Azure AD Connect.

- **Change History:** Gather any available history of password changes and account lockout incidents.

Having this information will aid in diagnosing further issues and informing support personnel if deeper investigation is required.

### Conclusion

By following these steps, you should be able to both diagnose and rectify the AADSTS120012 error, ensuring a smoother user experience across your organization’s identity management systems.