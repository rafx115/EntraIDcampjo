# AADSTS1000104: XCB2BResourceCloudNotAllowedOnIdentityTenant - Resource cloud {resourceCloud} isn't allowed on identity tenant {identityTenant}. {resourceCloud} - cloud instance which owns the resource. {identityTenant} - is the tenant where signing-in identity is originated from.


## Troubleshooting Steps
### Troubleshooting Guide for AADSTS1000104: XCB2BResourceCloudNotAllowedOnIdentityTenant

**Error Description:**  
The error `AADSTS1000104 - XCB2BResourceCloudNotAllowedOnIdentityTenant` occurs when an application is attempting to access a resource that is not permitted on the identity tenant from which the user is signing in. The `resourceCloud` refers to the cloud instance hosting the resource, while `identityTenant` is the origin tenant of the user signing in.

---

### 1. Initial Diagnostic Steps
- **Identify the Tenant and Resource:** Confirm the `identityTenant` and `resourceCloud` mentioned in the error. This information is crucial for understanding the configuration and permission context.
  
- **Check for Multi-Tenant Applications:** Determine if the application attempting to access the resource is configured to be multi-tenant.

- **Review User Sign-In:** Ensure that the user attempting to sign in is utilizing the correct account associated with the intended `identityTenant`.

- **Collect Logs and Error Details:** Gather any relevant logs or details surrounding the authentication attempt to provide context when troubleshooting.

---

### 2. Common Issues that Cause This Error
- **Cross-Cloud Access Restrictions:** The application is trying to access resources in a different Azure cloud that does not allow access from the identity tenant.

- **Tenant Configuration:** The identity tenant may not be configured correctly to allow access to the targeted resource cloud.

- **Application Registration Misconfigurations:** The application in Azure AD may not be set to allow the correct audiences or permissions.

- **User Permissions:** The user may not have the required permissions assigned to access the resource.

- **Deployment Region Issues:** Resources may be deployed in a cloud environment that the identity tenant does not recognize.

---

### 3. Step-by-Step Resolution Strategies
1. **Verify Tenant Configuration:**
   - Check Azure AD settings for the `identityTenant`.
   - Ensure that the tenant is correctly configured to access the specified `resourceCloud`.

2. **Review Application Registration:**
   - Log in to the Azure portal.
   - Navigate to **Azure Active Directory > App registrations**.
   - Locate the application and check the API permissions to verify if permissions to access the intended resource are granted.

3. **Multi-Tenant Configuration:**
   - If itï¿½s a multi-tenant application, ensure that it is configured as such and that users from the identity tenant have consented to the application.
   - Verify that the application accepts users from external tenants and check the 'Supported account types' setting in the application registration.

4. **Check Resource Permissions:**
   - Confirm that the user has the appropriate role and permissions assigned to access the resource in the `resourceCloud`.
   - Update user permissions if necessary.

5. **Cross-Cloud Compatibility:**
   - If your application is attempting to access resources in different Azure cloud instances (e.g., Azure US vs. Azure Germany), check the configurations and Azure policies which might restrict access across clouds.

---

### 4. Additional Notes or Considerations
- **Tenant Isolation:** Be aware that each Azure tenant is isolated, meaning that resources in one cloud may not be accessible from another without proper configurations.
  
- **Microsoft Documentation:** Always reference Microsoft's official documentation for the most current guidelines and practices.

---

### 5. Documentation Links
- Azure Active Directory Documentation: [Azure AD Docs](https://docs.microsoft.com/en-us/azure/active-directory/)
- Manage Application Registrations: [App registrations in Azure](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- API Permission Management: [API permissions in Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/develop/permissions-reference)

**Note:** Ensure that the links are accessible at the time of use.

---

### 6. Test Documentation Accessibility
- Open the provided links in a web browser. Confirm that the pages load without issues. Bookmark them for quick access while troubleshooting.

---

### 7. Advice for Data Collection
- **Collect Detailed Logs:** Capture Azure AD sign-in logs and any application-specific logs for the instance encountering the error.
- **Record User Actions:** Document the steps taken by the user leading up to the error, including any specific configurations or inputs.
- **Gather Tenant Information:** Note the tenant ID and any service principals or app registrations associated.

By following this comprehensive guide, you should be able to identify the root causes leading to the AADSTS1000104 error and implement the necessary resolutions.