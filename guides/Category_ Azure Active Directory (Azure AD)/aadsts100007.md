# AADSTS100007: Microsoft Entra Regional ONLY supports auth either for MSIs OR for requests from MSAL using SN+I for 1P apps or 3P apps in Microsoft infrastructure tenants.


## Troubleshooting Steps
## Troubleshooting Guide for Error Code AADSTS100007

### Description
Error code AADSTS100007 indicates that Microsoft Entra (formerly known as Azure Active Directory) only supports authentication for Managed Service Identities (MSIs) or requests from the Microsoft Authentication Library (MSAL) using Service Principal Names (SPNs) for first-party (1P) or third-party (3P) applications in Microsoft infrastructure tenants.

### Initial Diagnostic Steps
1. **Validate the Error Message**: Confirm you are encountering the specific error code AADSTS100007 by checking the error response in your application logs or authentication request logs.
2. **Identify the Context**:
   - Determine whether the request is coming from an MSI or if you're using MSAL with a Service Principal.
   - Check whether your application is a first-party or third-party application.

3. **Check Tenant Type**: 
   - Confirm the environment is set up as a Microsoft infrastructure tenant.
   - If using a third-party application, check whether it has the necessary permissions and is consented correctly.

### Common Issues That Cause This Error
1. **Incorrect Use of Authentication**: Attempting to authenticate using an unsupported method (e.g., non-MSI applications, or other non-MSAL options).
2. **Tenant Misconfiguration**: Having a tenant that is not configured for MSIs or improper permissions assigned to service principals.
3. **Invalid Request Types**: Using methods or libraries that do not align with AAD's expected authentication scenarios (e.g., using legacy libraries).
4. **Scope Misconfiguration**: Incorrect scope or resource identifiers sent in the authentication request.

### Step-by-Step Resolution Strategies

1. **Check Application Type**:
<<<<<<< HEAD:guides/Category_ Azure Active Directory (Azure AD)/aadsts100007.md
   - Ensure your application is using MSAL properly if its a first-party or third-party application.
   - Confirm the request is compliant with Microsofts authentication requirements for the application type and service being used.
=======
   - Ensure your application is using MSAL properly if it�s a first-party or third-party application.
   - Confirm the request is compliant with Microsoft�s authentication requirements for the application type and service being used.
>>>>>>> 8ca1440664e61dbdf9b1aa83f352634474c59c2f:guides/aadsts100007.md

2. **Use Managed Service Identity** (if applicable):
   - If your application can use MSI, you should enable and configure MSI for your Azure resources.
   - Refer to [Using Managed Identities for Azure Resources](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview) to set up and authenticate using MSI.

3. **Adjust MSAL Implementation**:
   - If using MSAL, ensure the library is up-to-date and follows recommended practices.
   - For detailed guidance, refer to [Microsoft Authentication Library Documentation](https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview).

4. **Validate API Permissions**:
   - In your Azure portal, navigate to your app registration and verify API permissions. Ensure that all necessary permissions are granted and that admin consent is provided if required.
   - Explore the permission settings in [Azure Active Directory App Registrations](https://learn.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app).

5. **Verify Authentication Scope**:
   - Confirm the scopes requested in the token request align with the ones you have configured for your application.
   - Review [Microsoft Documentation on OAuth 2.0 Authorization](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow) for correct setup.

### Additional Notes or Considerations
- Always use the latest MSAL version to ensure compatibility and the most recent features.
- Test in a non-production environment first before rolling out changes to production apps.
- Make sure that your Azure AD tenant settings are properly configured for the authentication patterns you require.

### Documentation Where Steps Can Be Found
- [Microsoft Identity platform documentation](https://learn.microsoft.com/en-us/azure/active-directory/develop/)
- [Managed Identities for Azure Resources](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview)
- [Microsoft Authentication Library (MSAL) Documentation](https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview)

### Test the Documentation Can Be Reachable
Before relying on the documentation, ensure you test access:
1. Visit the documentation links above and ensure they load properly.
2. Bookmark important pages for quick reference in the future.

### Advice for Data Collection
- **Logging**: Implement comprehensive logging around authentication attempts. Capture request details, timestamps, and response messages.
- **Trace Request IDs**: If applicable, use request IDs provided by the Azure AD to trace requests in logs and identify issues.
- **Monitor Failures**: Utilize Azure Monitor or Application Insights to observe the frequency and patterns of specific authentication errors.

By methodically following this guide, you should be able to diagnose and resolve the AADSTS100007 error effectively. Remember to correlate the solution with your specific application architecture and authentication flow.

Category: Category_ Azure Active Directory (Azure AD)