
# AADSTS650057: Invalid resource. The client has requested access to a resource which isn't listed in the requested permissions in the client's application registration. Client app ID: {appId}({appName}). Resource value from request: {resource}. Resource app ID: {resourceAppId}. List of valid resources from app registration: {regList}.


## Troubleshooting Steps
Certainly! Below is a detailed troubleshooting guide for the AADSTS650057 error, which is triggered when a client application requests access to a resource that is not configured in its registered permissions.

### Troubleshooting Guide for AADSTS650057

#### 1. Initial Diagnostic Steps
- **Identify the Exact Error Message:** Confirm the error message, client app ID, resource value from the request, resource app ID, and valid resources from app registration.
- **Check the Application Registration:** Login to the Azure portal and navigate to Azure Active Directory > App registrations. Verify the application registration for `{appName}` using `{appId}`.
- **Review the Request Context:** Identify the exact request that triggered the error. This can often be found in the application logs.

#### 2. Common Issues That Cause This Error
- **Missing Permissions:** The application may not have permissions for the requested resource in the Azure AD configuration.
- **Wrong Resource Request:** The resource value in the request might be incorrect or misconfigured.
- **Consent Not Granted:** If the application requires user or admin consent for specific permissions, it might not have been granted.
- **Resource Not Supported:** The requested resource might not be a valid resource for the application, or it could be an incorrect application ID.

#### 3. Step-by-Step Resolution Strategies
1. **Verify Resource Value:**
   - Check the `resource` value provided in the error message. Ensure it matches an existing resource application within your Azure AD.

2. **Check Application Permissions:**
   - In the Azure portal, go to **Azure Active Directory > App registrations > {appName}**.
   - Click on **API permissions**.
   - Ensure the listed permissions include the resource you are trying to access. If not, you will need to add it.

3. **Add Required Permissions:**
   - If the resource is not listed:
     - Click on **Add a permission**.
     - Select the type of resource (Microsoft APIs or other APIs).
     - Choose the resource from the list or add a custom API.
     - Select the necessary permissions based on your appâ€™s requirements.

4. **Grant Admin Consent (if necessary):**
   - After adding permissions, if the permissions require admin consent:
     - Click on **Grant admin consent for {your organization}**.

5. **Test the Configuration:**
   - After making changes, test the application again to see if the issue has been resolved.

#### 4. Additional Notes or Considerations
- Be mindful of permission scopes; ensure the correct scopes are being requested in the application code.
- If multiple environments (development, staging, production) exist, ensure changes are propagated to the correct environment.
- Monitor Azure AD for audit logs that can provide additional context on permission failures.

#### 5. Documentation for Guidance
- [Azure AD App registrations documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- [API permissions in Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-app-permissions)
- [Granting admin consent](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-admin-consent)

#### 6. Verify Availability of Documentation
- Ensure that the links provided above are active and accessible. You can check this by opening them in a browser.

#### 7. Advice for Data Collection
- While troubleshooting, collect the following data:
  - The exact error responses from Azure AD.
  - Logs from your application detailing API requests and responses.
  - Changes made during the troubleshooting process, including timestamps.
  
### Conclusion
By following this troubleshooting guide, you should be able to identify and resolve the AADSTS650057 error effectively. Remember to monitor the application performance after making changes and involve stakeholders as needed during the process.