# AADSTS900382: Confidential Client isn't supported in Cross Cloud request.


## Troubleshooting Steps
### Troubleshooting Guide for Error Code AADSTS900382

**Error Description:**  
AADSTS900382: Confidential Client isn't supported in Cross Cloud request.

This error typically occurs when a confidential client application is trying to make a token request across different Azure Active Directory (AAD) clouds, such as trying to authenticate against Azure AD while the application is configured for Azure AD B2C or vice versa.

---

### Initial Diagnostic Steps

1. **Verify the Request Context**:
   - Check if the application is running and making requests in the correct AAD cloud.
   - Identify whether the application is supposed to operate in Azure AD or Azure AD B2C.

2. **Investigate Application Registration**:
   - Ensure the application is registered correctly in the appropriate Azure portal.
   - Verify the type of application (confidential vs. public) and its settings.

3. **Review the Authentication Request**:
   - Analyze the OAuth2/OpenID Connect request being made.
   - Check for the endpoint being called and confirm that it matches the expected endpoint for the target cloud.

### Common Issues that Cause This Error

1. **Cross-Cloud Configuration**:
   - The application is configured in one Azure cloud but is trying to authenticate against another (e.g., attempting to use Azure AD B2C with Azure AD credentials).

2. **Misconfigured Application Secrets or Certificates**:
   - The application may not have the correct credentials defined for the target cloud where it is attempting to authenticate.

3. **Incompatible Authentication Flows**:
   - The application is using an authentication flow that is not compatible with the expected application type in the context.

### Step-By-Step Resolution Strategies

1. **Identify the Target Cloud**:
   - Determine the intended authentication context. Should your application be communicating with Azure AD, Azure AD B2C, or another AAD cloud?

2. **Check Application Registration**:
   - Log into the Azure portal and navigate to **Azure Active Directory > App registrations**.
   - Find your application and ensure it is properly registered for the intended cloud environment.

3. **Update Application Configuration**:
   - If the application is misconfigured (for instance, using Azure AD B2C endpoints with an Azure AD application), update it to align with the correct authentication flows and endpoints.
   - Make sure the application is registered as a confidential client (using client secret or certificates) if using server-to-server authentication.

4. **Reconfigure Authentication Endpoints**:
   - Ensure your application is calling the right `/token` endpoint (e.g., for Azure AD, it's typically `https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token`; for Azure AD B2C, it's `https://{tenant}.b2clogin.com/{tenant}.onmicrosoft.com/{policy}/oauth2/v2.0/token`).

5. **Test with Correct Configuration**:
   - Utilize tools such as Postman to test the authentication flow with the updated configurations to ensure it works as expected.

6. **Review API Permissions**:
   - Check on the permissions granted to the application to ensure that it has the necessary access to the resources it is trying to access.

### Additional Notes or Considerations

- Ensure that there are no network issues or miscommunication between different services across regions and clouds.
- If your organization has policies regarding access and configurations, consult with your IT department or security team.

### Documentation for Guidance

- Azure AD Authentication Documentation: [Microsoft Docs - Azure Active Directory documentation](https://docs.microsoft.com/en-us/azure/active-directory/)
- Authentication Flows in Azure AD: [Microsoft Docs - OAuth 2.0 and OpenID Connect](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview)

### Testing Documentation Reachability

To ensure that the documentation is reachable, you can visit the links above in a web browser or use command-line tools like `curl`:

```bash
curl -I https://docs.microsoft.com/en-us/azure/active-directory/
```

If the site is reachable, you will see HTTP status 200 OK.

### Advice for Data Collection

1. **Log Error Details**: Collect logs from the application that may show more detailed error information, including request and response headers.
2. **Identity Token Claims**: Capture the claims from the ID token (if applicable) to understand what user/context you are working with.
3. **Network Tracing**: Utilize network tracing if necessary, such as Fiddler or Wireshark, to see the HTTP requests being sent and received.
4. **Error Codes**: Document any additional error codes or messages that are presented alongside AADSTS900382 for broader context.

Following these steps should help diagnose and resolve the AADSTS900382 error in your applicationâ€™s authentication flow.