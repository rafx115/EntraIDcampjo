# AADSTS7000114: Application 'appIdentifier' isn't allowed to make application on-behalf-of calls.


## Troubleshooting Steps
Certainly! The error code AADSTS7000114 with the description "Application 'appIdentifier' isn't allowed to make application on-behalf-of calls" typically indicates issues related to Azure Active Directory (AAD) where the application is not properly configured to use the on-behalf-of flow. Here’s a comprehensive troubleshooting guide to help you identify and resolve this error.

### 1. Initial Diagnostic Steps

- **Identify the Application:** Confirm the appIdentifier in the error message corresponds to the application you are working on.
- **Review the Context:** Determine under which circumstances the error occurs (e.g., during a specific API call).
- **Check Service Status:** Ensure that Azure services are operational by checking the [Azure Status page](https://status.azure.com/).

### 2. Common Issues that Cause This Error

- The application does not have the appropriate permissions configured in Azure AD.
- The application is not registered correctly or is missing required settings.
- The app doesn’t have the "Allow this application to be delegated the following permissions" checked.
- There are issues with the implicit grant flow in your application.

### 3. Step-by-step Resolution Strategies

#### Step 1: Verify Application Registration

1. **Access Azure Portal:**
   - Navigate to the [Azure Portal](https://portal.azure.com/).
   
2. **Find Your Application:**
   - Go to "Azure Active Directory" > "App registrations."
   - Locate your application using its name or appIdentifier.

#### Step 2: Check API Permissions

1. **API Permissions:**
   - Click on "API permissions" in the left menu.
   - Ensure that you have the necessary permissions listed under "Delegated permissions."
   - If you intend to perform on-behalf-of calls, you typically need permissions such as `User.Read` or other relevant permissions for accessing APIs on behalf of the user.

2. **Grant Admin Consent:**
   - After ensuring the correct permissions are added, click the "Grant admin consent..." button if you are an administrator.

#### Step 3: Application Manifest

1. **Open Application Manifest:**
   - In the application's registration page, click on "Manifest."
   
2. **Check for On-Behalf-Of Permissions:**
   - Look for the `oauth2AllowObo` property and make sure it is set to `true`. If it’s not there, you may need to add it.
   
3. **Modify Manifest:**
   - If needed, make adjustments to the manifest for configurations that may be required for on-behalf-of flow.

#### Step 4: Update Your Code

- Ensure that your code is correctly set up to use the on-behalf-of flow by properly obtaining the access tokens using the ADAL or MSAL libraries. Refer to [Microsoft Authentication Library (MSAL) Documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-overview).

#### Step 5: Testing

- After making changes, test the application to confirm that the error no longer appears. Verify that the correct access tokens are being received and utilized.

### 4. Additional Notes or Considerations

- **Caching:** If your application uses token caching, clear the cache after making configuration changes to ensure that old tokens do not interfere with your tests.
- **Scoped Access Tokens:** Ensure the access tokens obtained have the correct scopes included.
- **Pre-Deployment Review:** Review configuration for production environments if changes were made in development.

### 5. Documentation for Guidance

- [MSAL for .NET](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-overview)
- [Azure Active Directory App Guidelines](https://docs.microsoft.com/en-us/azure/active-directory/develop/develop-app-registration)
- [Understanding OBO flow](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth-on-behalf-of)
- [Application Permissions vs. Delegated Permissions](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-app-types)

### 6. Test Documentation Reachability

- Open links provided in the documentation section above to confirm they lead to the correct and active pages. If links are broken or unavailable, note them for further action.

### 7. Advice for Data Collection

- **Logs:** Enable logging for your application. Capture logs showing tokens being requested and any responses/errors that surface.
- **Token Inspection:** Use tools like [JWT.io](https://jwt.io/) to inspect JWT tokens you receive to confirm the permissions and scopes.
- **Error Messages:** Document the full error messages and stack traces for deeper investigation if necessary.

By following the above strategies and utilizing the resources provided, you should be able to diagnose and resolve the AADSTS7000114 error effectively.