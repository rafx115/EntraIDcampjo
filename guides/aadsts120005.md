
# AADSTS120005: PasswordChangeOnPremSuccessCloudFail


## Troubleshooting Steps
### Troubleshooting Guide for AADSTS120005: PasswordChangeOnPremSuccessCloudFail

The error code **AADSTS120005** indicates a scenario where the password change operation succeeded on the on-premises Active Directory but failed to sync that change to Azure Active Directory (Azure AD). This typically occurs in hybrid identity environments.

### Initial Diagnostic Steps

1. **Check the Error Message**: Review the full error message for additional context regarding the failure, which helps identify the specific issue.
  
2. **Identify the User's Status**: Determine whether the user is a synchronized user (id: a user whose identity resides in on-premises AD and is synced with Azure AD).

3. **Review Logs**: Check the Azure AD sign-in logs and the Azure AD Connect synchronization logs for errors.
   
4. **Verify Password Reset Policies**: Ensure that the company policies regarding password changes are being followed.

### Common Issues that Cause This Error

1. **Synchronization Issues**: The Azure AD Connect synchronization process may have restarted, is delayed, or has been misconfigured.

2. **Password Writeback Configuration**: If password writeback is not enabled, changes made on-premises may not sync to Azure AD.

3. **Network Connectivity**: There might be temporary network connectivity issues affecting the synchronization process between on-premises AD and Azure AD.

4. **User State**: The user’s account might be in a state that prevents the change from being recognized, such as being locked out or disabled.

5. **Service Health Issues**: There may be ongoing issues with Azure AD services.

### Step-by-Step Resolution Strategies

1. **Verify Azure AD Connect Configuration**:
   - Open the Azure AD Connect tool.
   - Ensure that password writeback is enabled. If not, reconfigure it to enable this feature.

2. **Check Synchronization Status**:
   - Go to Azure Active Directory -> Azure AD Connect -> Synchronization Status.
   - Check the synchronization status for errors and ensure that the last sync completed successfully.

3. **Force Manual Synchronization**:
   - Open PowerShell on the server where Azure AD Connect is installed.
   - Execute the command to start a manual sync:
     ```powershell
     Start-ADSyncSyncCycle -PolicyType Delta
     ```
   - Wait for the sync to complete and check if the password change now reflects in Azure AD.

4. **Review Azure AD Sign-in Logs**:
   - Go to Azure Active Directory -> Sign-ins.
   - Filter the logs for the affected user and review any related sign-in failures or warnings.

5. **Check Network Connectivity**:
   - Ensure that the Azure AD Connect server can communicate with Azure AD without any interruptions.
   - Test connection to Azure using PowerShell commands or simple ping tests.

6. **Inspect User Account Properties**:
   - Using Active Directory Users and Computers, check the state of the user account.
   - Ensure it is not disabled or locked out.

7. **Review Azure AD Health**:
   - Check the Azure service health dashboard for any ongoing issues with Azure AD:
     [Azure Service Health](https://portal.azure.com/#blade/Microsoft_Azure_Health/ServiceHealthBlade)

### Additional Notes or Considerations

- It is crucial to have timely synchronization between on-premises AD and Azure AD. If delays persist, investigate and rectify any underlying issues with Azure AD Connect or the on-premises environment.
  
- Always wait a few minutes after any configuration changes before testing again, as changes may take time to propagate.

### Documentation and Guidance

Refer to the following Microsoft documentation for accurate guidance on handling Azure AD and AAD Connect configurations:

- [Azure AD Connect: Password writeback](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/tutorial-password-writeback)
- [Azure AD Connect: Troubleshooting](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/tshoot-azure-ad-connect)
- [Azure AD Sign-ins](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-sign-ins)
  
Make sure these documents are accessible through your organizational network.

### Test Document Reachability

To ensure document reachability, visit these links in your browser:
- [Azure AD Connect: Password Writeback](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/tutorial-password-writeback)
- [Azure AD Connect: Troubleshooting](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/tshoot-azure-ad-connect)
- [Azure AD Sign-ins](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-sign-ins)

### Advice for Data Collection

When gathering data for troubleshooting:
1. **Collect User Information**: Capture the user’s unique identifier (UPN/email) and any error messages encountered.
2. **Gather Log Files**: Export Azure AD Connect synchronization logs and Azure AD sign-in logs.
3. **System Health Check**: Monitor overall system health and performance metrics of the Azure AD Connect server.

By following this guide, you can effectively troubleshoot the **AADSTS120005** error and work towards a resolution. If issues persist after following these steps, consider involving Microsoft Support for further assistance.